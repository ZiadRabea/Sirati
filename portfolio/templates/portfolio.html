{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sirati – Portfolio</title>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* Base */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    html,body { height: 100%; }
    body { background: #0e0e0e; color: #fff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow-x:hidden; }

    /* Hero */
    .hero { height: 100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background: radial-gradient(circle at 30% 30%, #222, #000); position:relative; text-align:center; padding: 40px 20px; }
    .hero img { width:150px;height:150px;border-radius:50%;margin-bottom:20px;opacity:0;animation:fadeUp .8s ease forwards; object-fit:cover; border: 3px solid rgba(255,255,255,0.04); }
    .hero h1 { font-size:4rem; font-weight:800; letter-spacing: -1px; opacity:0; animation:fadeUp 1s ease forwards; }
    .hero p { margin-top:12px; font-size:1.15rem; opacity:0; animation:fadeUp 1.3s ease forwards; color:#cfcfcf; }
    .hero a, .skills a { display:inline-block;margin-top:20px;padding:12px 30px;background:#111;border:1px solid #444;color:white;border-radius:10px;text-decoration:none;font-size:1.05rem; transition: transform .18s ease, box-shadow .18s ease; }
    .skills a {display: block; width: 100%; text-align: center;}
    .hero a:hover, .skills a:hover { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0,0,0,0.6); }

    @keyframes fadeUp { 0% { opacity:0; transform: translateY(20px);} 100% { opacity:1; transform: translateY(0);} }

    /* Sections */
    .section-title { text-align:center; font-size:2.5rem; margin:80px 0 40px; font-weight:700; color:#f7f7f7; }
    .services { display:grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap:20px; width:90%; margin: auto; }
    .card { background:#1a1a1a; padding:25px; border-radius:16px; transition: transform .25s ease, box-shadow .25s ease; border:1px solid #333; }
    .card:hover { transform: translateY(-8px); box-shadow: 0 0 40px rgba(255,255,255,0.03); }

    .timeline { width:90%; margin:80px auto; border-left:2px solid #444; padding-left:30px; }
    .milestone { margin-bottom:40px; position:relative; color:#dcdcdc; }
    .milestone::before { content:""; width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;left:-40px;top:0; box-shadow: 0 0 10px rgba(255,255,255,0.03); }

    .projects { display:grid; grid-template-columns: repeat(auto-fit,minmax(320px,1fr)); gap:25px; width:90%; margin: auto; }
    .project-card { background:#141414; border:1px solid #333; padding:20px; border-radius:14px; transition: transform .2s ease, box-shadow .2s ease; display:flex; gap:14px; align-items:flex-start; }
    .project-card:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(255,255,255,0.04); }
    .project-body { flex:1 1 auto; }
    .project-image { width:110px; height:110px; border-radius:10px; object-fit:cover; flex-shrink:0; border:1px solid rgba(255,255,255,0.04); background:linear-gradient(180deg,#0e0e0e,#151515); display:block; }
    .project-title { font-weight:700; font-size:1.05rem; margin-bottom:6px; color:#fff; }
    .project-about { color:#cfcfcf; font-size:0.95rem; margin-bottom:10px; line-height:1.45; max-height:4.35rem; overflow:hidden; text-overflow:ellipsis; }

    /* tech chips */
    .tech-list { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; align-items:center; }
    .tech-chip {
      font-size:0.82rem;
      padding:6px 9px;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      color:#e7e7e7;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      max-width:100%;
    }
    .tech-chip i { opacity:0.9; font-size:0.78rem; color:#bdbdbd; }

    .project-meta { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px; color:#bfbfbf; font-size:0.9rem; }

    .cta { text-align:center; margin:80px 0 120px; }

    /* Floating icons */
    .float-icon { width:18px;height:18px;border-radius:50%;background:#0a0a0a; transition: background .25s, box-shadow .25s, transform .18s; cursor:pointer; border:1px solid rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; }
    .float-icon.active { background: #00f2ff; box-shadow: 0 0 12px #00f2ff; transform: scale(1.08); }
    .float-icon:focus { outline: 2px solid rgba(124,92,255,0.6); outline-offset: 3px; }

    /* ---------------------------
       Skills (progress bars)
       --------------------------- */
    .skills { width:90%; margin: 0 auto 40px; max-width: 900px; }
    .skill { margin-bottom: 18px; }
    .skill .label-row { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px; }
    .skill .label-row .name { font-weight:600; color:#eaeaea; }
    .skill .label-row .percent { font-size:0.95rem; color:#bfbfbf; min-width:46px; text-align:right; }

    .progress { background: linear-gradient(90deg,#262626,#1a1a1a); height:14px; border-radius:10px; overflow:hidden; position:relative; border:1px solid rgba(255,255,255,0.03); }
    .progress .bar {
      height:100%;
      width:0%;
      border-radius:10px;
      background:
        linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.06)),
        linear-gradient(120deg, #00f2ff 0%, #7c5cff 55%, #ff66b3 100%);
      transform-origin: left center;
      transition: width 1.1s cubic-bezier(.22,.9,.32,1);
      position:relative;
      overflow:hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6) inset;
      will-change: width; /* hint to browser for smoother anim */
    }

    /* animated stripe overlay */
    .progress .bar::after {
      content:"";
      position:absolute;
      inset:0;
      background-image: linear-gradient(45deg, rgba(255,255,255,0.06) 25%, rgba(255,255,255,0.02) 25%, rgba(255,255,255,0.02) 50%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.06) 75%, rgba(255,255,255,0.02) 75%, rgba(255,255,255,0.02) 100%);
      background-size: 40px 40px;
      mix-blend-mode: overlay;
      animation: stripes 2s linear infinite;
      pointer-events:none;
      opacity:0.55;
    }
    @keyframes stripes { from { background-position: 0 0; } to { background-position: 40px 0; } }

    /* subtle glow trailing the bar */
    .progress .bar::before {
      content:"";
      position:absolute;
      right: -30px;
      top: -25%;
      width:60px;
      height:150%;
      filter: blur(20px);
      background: radial-gradient(closest-side, rgba(255,255,255,0.08), rgba(255,255,255,0) 60%);
      opacity:0.5;
      transform: translateX(0);
      transition: transform 1.1s cubic-bezier(.22,.9,.32,1);
      pointer-events:none;
    }

    /* When filled, make the glow stick to the right edge by moving it */
    .bar-filled::before { transform: translateX(calc(-1 * (100% - var(--target-offset, 100%)))); }

    /* ---------------------------
       About / Contact block additions
       --------------------------- */
    .about-wrap { width:90%; margin: 36px auto; max-width:900px; display:flex; gap:18px; align-items:flex-start; }
    .about-card { background:#111; border:1px solid rgba(255,255,255,0.04); padding:18px; border-radius:12px; display:flex; gap:14px; align-items:flex-start; width:100%; }
    .about-left { width:120px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .about-avatar { width:96px; height:96px; border-radius:12px; object-fit:cover; border:1px solid rgba(255,255,255,0.04); }
    .about-right { flex:1; }
    .bio-text { color:#dcdcdc; line-height:1.5; margin-bottom:10px; }
    .about-meta { display:flex; gap:14px; align-items:center; color:#bfbfbf; font-size:0.95rem; flex-wrap:wrap; }
    .meta-item { display:inline-flex; gap:8px; align-items:center; background: rgba(255,255,255,0.02); padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.03); }
    .meta-item a { color:inherit; text-decoration:none; font-weight:600; }

    /* Contact card (kept) */
    .contact-card {
      width: min(720px, 92%);
      margin: 0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 16px;
      padding: 28px;
      display:flex;
      gap:28px;
      align-items:flex-start;
      justify-content:space-between;
      border: 1px solid rgba(124,92,255,0.12);
      box-shadow: 0 6px 40px rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
    }

    .contact-left { flex: 1 1 280px; }
    .contact-right { width: 360px; max-width: 45%; }

    .contact-card h3 { font-size:1.35rem; margin-bottom:8px; }
    .contact-card p.lead { color:#cfcfcf; margin-bottom:16px; font-size:0.98rem; }

    form.contact-form { display:flex; flex-direction:column; gap:12px; }
    .field {
      position:relative;
      display:flex;
      align-items:center;
      gap:10px;
      background: rgba(255,255,255,0.02);
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.02);
      transition: box-shadow .15s ease, border-color .15s ease, transform .08s ease;
    }
    .field:focus-within { border-color: rgba(124,92,255,0.9); box-shadow: 0 6px 22px rgba(124,92,255,0.06); transform: translateY(-2px); }
    .field svg { width:18px;height:18px; opacity:0.9; flex-shrink:0; color:#bdbdbd; fill:currentColor; }

    .field input, .field textarea {
      background: transparent;
      border: none;
      outline: none;
      color: #fff;
      width:100%;
      font-size:0.98rem;
      resize:vertical;
    }

    .small-note { font-size:0.82rem; color:#bdbdbd; margin-top:6px; }

    .btn-send {
      margin-top:8px;
      padding:12px 16px;
      border-radius:10px;
      background: linear-gradient(90deg,#7c5cff,#00f2ff);
      border:none;
      color:#08121a;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 8px 30px rgba(124,92,255,0.14);
      transition: transform .15s ease, box-shadow .15s ease, opacity .12s ease;
    }
    .btn-send:hover { transform: translateY(-3px); opacity:0.98; box-shadow: 0 12px 40px rgba(124,92,255,0.18); }

    /* toast */
    .toast {
      position:fixed;
      right:20px;
      bottom:20px;
      background: linear-gradient(180deg,#0b0b0b,#111);
      border: 1px solid rgba(124,92,255,0.14);
      color:#e8faff;
      padding:12px 16px;
      border-radius:10px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.6);
      transform: translateY(20px);
      opacity:0;
      transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .2s ease;
      z-index: 9999;
      display:flex;
      align-items:center;
      gap:10px;
      min-width:220px;
    }
    .toast.show { transform: translateY(0); opacity:1; }

    /* success and error variations */
    .toast.success {
      background: linear-gradient(180deg,#052e14,#084d24);
      border-color: rgba(34,197,94,0.18);
      color: #d1fae5;
    }
    .toast.error {
      background: linear-gradient(180deg,#2b0404,#5a0808);
      border-color: rgba(239,68,68,0.18);
      color: #ffe4e4;
    }

    /* Publish request floating button */
    .publish-btn {
      position: fixed;
      right: 20px;
      bottom: 92px;
      z-index: 9998;
      width:56px;
      height:56px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg,#ff8ad6,#7c5cff);
      box-shadow: 0 10px 30px rgba(124,92,255,0.18);
      border: none;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .2s ease, opacity .12s ease;
      color: #08121a;
      position:fixed;
    }
    .publish-btn:hover { transform: translateY(-4px); box-shadow: 0 18px 40px rgba(124,92,255,0.22); }
    .publish-btn .label {
      position:absolute;
      right:70px;
      background: rgba(11,11,11,0.9);
      color: white;
      padding:8px 12px;
      border-radius:10px;
      font-weight:600;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      transform: translateY(4px);
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
      white-space:nowrap;
    }
    .publish-btn:focus .label,
    .publish-btn:hover .label { transform: translateY(0); opacity:1; }

    /* disabled & loading styles */
    .publish-btn.disabled {
      opacity: 0.55;
      cursor: not-allowed !important;
      transform: none;
      box-shadow: none;
    }
    .publish-btn.loading {
      cursor: progress !important;
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 18px 50px rgba(0,0,0,0.45);
    }
    .publish-btn .spinner {
      font-size: 18px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { from { transform: rotate(0deg);} to { transform: rotate(360deg);} }

    /* Floating nav container */
    #float-nav { position:fixed; top:50%; left:20px; transform:translateY(-50%); display:flex; flex-direction:column; gap:15px; z-index:999; }

    /* Responsive: hide float nav on small screens so it doesn't overlay content */
    @media (max-width:920px) {
      .contact-card { flex-direction:column; gap:18px; padding:20px; }
      .contact-right { width:100%; max-width:100%; }
      .hero h1 { font-size:2.6rem; }

      /* Hide left floating nav (touch devices) */
      #float-nav { display:none; }

      /* Reposition publish button a bit higher to avoid overlapping footers/CTA */
      .publish-btn { bottom: 110px; right: 18px; }

      .about-wrap { flex-direction:column; gap:12px; }
      .project-card { flex-direction:column; align-items:stretch; }
      .project-image { width:100%; height:180px; border-radius:10px; }
    }
    /* ---------------------------
   Flash Messages
    --------------------------- */
    #flash-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 99999;
      width: min(420px, 90%);
    }

    .flash-message {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 18px;
      border-radius: 12px;
      background: #111;
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(6px);
      font-size: 0.95rem;
      animation: flashSlide 0.45s cubic-bezier(.2,.9,.2,1);
      box-shadow: 0 8px 28px rgba(0,0,0,0.55);
      opacity: 0.95;
    }

    /* success */
    .flash-message.success {
      border-color: rgba(34,197,94,0.25);
      background: linear-gradient(180deg,#052e14,#0c4d2b);
      color: #d4fbe4;
    }
    /* error */
    .flash-message.error {
      border-color: rgba(239,68,68,0.25);
      background: linear-gradient(180deg,#2b0404,#5a0808);
      color: #ffe4e4;
    }
    /* warning */
    .flash-message.warning {
      border-color: rgba(255,165,0,0.35);
      background: linear-gradient(180deg,#332103,#5a3a07);
      color: #fff3d6;
    }
    /* info */
    .flash-message.info {
      border-color: rgba(124,92,255,0.3);
      background: linear-gradient(180deg,#0b0b0b,#141020);
      color: #e8e7ff;
    }

    .flash-icon i {
      font-size: 18px;
    }

    /* animation */
    @keyframes flashSlide {
      from {
        transform: translateY(-20px) scale(0.97);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }
    .about-socials {
      display: flex;
      gap: 12px;
      margin-top: 14px;
    }

    .about-socials a {
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: #141414;
      color: #bdbdbd;
      font-size: 1rem;
      transition: all 0.25s ease;
      text-decoration: none;
    }

    .about-socials a:hover {
      color: #fff;
      background: linear-gradient(135deg, #6e7cff, #9f7cff);
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(159,124,255,0.35);
    }

  </style>
</head>
<body>
    {% if messages %}
  <div id="flash-container">
    {% for message in messages %}
      <div class="flash-message {{ message.tags }}">
        <span class="flash-icon">
          {% if message.tags == "success" %}
            <i class="fas fa-check-circle"></i>
          {% elif message.tags == "error" %}
            <i class="fas fa-times-circle"></i>
          {% elif message.tags == "warning" %}
            <i class="fas fa-exclamation-triangle"></i>
          {% else %}
            <i class="fas fa-info-circle"></i>
          {% endif %}
        </span>
        <span>{{ message }}</span>
      </div>
    {% endfor %}
  </div>
  {% endif %}
  {# --- Publish request: only show when not active and owner is viewing --- #}
  {% if not website.is_active and user.profile == website.user %}
    <a style="text-decoration:none;color:none;" href="/publish" class="publish-btn" aria-label="Request publish" title="Request publish" aria-busy="false">
      <span class="label" aria-hidden="true">Request publish</span>
      <i class="fas fa-paper-plane" aria-hidden="true"></i>
    </a>
  {% endif %}

  <section id="hero" class="hero">
    <img src="{{website.profile_pic.url}}" alt="Profile photo of {{ website.full_name }}">
    <h1>{{website.full_name}}</h1>
    <p>{{website.current_job}}</p>
    <a href="{{website.cv_url}}" download>Download CV</a>
    {% if user.profile == website.user %}
      <a href="/{{website.unique_name}}/edit">Update Info<i class="fas fa-brush"></i></a>
    {% endif %}
  </section>

  {# New: About block (bio, age, email) #}
  <div class="about-wrap">
    <div class="about-card" role="region" aria-label="About the portfolio holder" data-birthdate="{% if website.birth_date %}{{ website.birth_date|date:'Y-m-d' }}{% endif %}">
      <div class="about-left">
        {% if website.profile_pic %}
          <img class="about-avatar" src="{{ website.profile_pic.url }}" alt="Avatar of {{ website.full_name }}">
        {% else %}
          <div class="about-avatar" aria-hidden="true" style="display:flex;align-items:center;justify-content:center;color:#bdbdbd;background:#0f0f0f;font-weight:700;">{{ website.full_name|default:''|slice:":1" }}</div>
        {% endif %}
        <div style="font-size:0.9rem;color:#cfcfcf;text-align:center;">{{ website.location|default:"" }}</div>
      </div>

      <div class="about-right">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;">
          <h2 style="margin:0;font-size:1.25rem;">About</h2>
          {% if user.profile == website.user %}
            <a href="/{{website.unique_name}}/edit" style="text-decoration:none;color:#bfbfbf;font-size:0.9rem;"><i class="fas fa-edit"></i> Edit</a>
          {% endif %}
        </div>

        <p class="bio-text">{{ website.about|default:"This person hasn't added a bio yet." }}</p>

        <div class="about-meta" aria-hidden="false">
          <div class="meta-item" title="Age">
            <i class="fas fa-birthday-cake" aria-hidden="true"></i>
            <span id="computed-age">{% if website.age %}{{ website.age }}{% else %}—{% endif %}</span>
          </div>

          <div style="font-size: 12px;" class="meta-item" title="Contact email">
            <i class="fas fa-envelope" aria-hidden="true"></i>
            {% if website.email %}
              <a href="mailto:{{ website.email }}" id="owner-email">Send an Email</a>
            {% else %}
              <span id="owner-email">—</span>
            {% endif %}
          </div>
          {% if website.website_url %}
            <div class="meta-item" title="Website">
              <i class="fas fa-link" aria-hidden="true"></i>
              <a href="{{ website.website_url }}" target="_blank" rel="noopener noreferrer">{{ website.website_url|cut:'https://'|cut:'http://' }}</a>
            </div>
          {% endif %}
        </div>
        {% if website.tele or website.wp or website.fb or website.inta %}
          <div class="about-socials" aria-label="Social media links">
            {% if website.tele %}
              <a href="{{ website.tele }}" target="_blank" rel="noopener" title="GitHub">
                <i class="fa-brands fa-telegram"></i>
              </a>
            {% endif %}

            {% if website.wp %}
              <a href="{{ website.wp }}" target="_blank" rel="noopener" title="LinkedIn">
                <i class="fa-brands fa-whatsapp"></i>
              </a>
            {% endif %}

            {% if website.fb %}
              <a href="{{ website.fb }}" target="_blank" rel="noopener" title="Twitter / X">
                <i class="fa-brands fa-facebook-f"></i>
              </a>
            {% endif %}

            {% if website.insta %}
              <a href="{{ website.insta}}" target="_blank" rel="noopener" title="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="section-title">What I Do</div>
  <section id="services" class="services">
    {% for skill in website.skill_set.all %}
      <div class="card">{{skill.skill}}</div>
    {% endfor %}
  </section>

  <div class="section-title">Skills</div>
  <!-- NEW: structured skills with animated progress -->
  <section id="skills" class="skills" aria-label="Skills">
    {% for skill in website.skill_set.all %}
    <div class="skill" data-percent="{{skill.mastery}}">
      <div class="label-row">
        <div class="name">{{skill.skill}}</div>
        <div class="percent" aria-hidden="true">0%</div>
      </div>
      <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="bar" data-target="{{skill.mastery}}"></div>
      </div>
    </div>
    {% endfor %}
    {% if user.profile == website.user %}
      <a href="/{{website.unique_name}}/skills"> + Add/Remove Skill<i class="fas fa-brush"></i></a>
    {% endif %}
  </section>

  <div class="section-title">My Journey</div>
  <section id="timeline" class="timeline">
    {% for experience in website.experience_set.all %}
      <div class="milestone">{{experience.job}} | {{experience.employer}}</div>
    {% endfor %}
    {% if user.profile == website.user %}
      <a style="text-decoration: none; font-weight: bold;" href="/{{website.unique_name}}/work" class="milestone"> + | Add a new experience</a>
    {% endif %}
  </section>

  <div class="section-title">Projects</div>
  <section id="projects" class="projects">
    {% for project in website.project_set.all %}
      <div class="project-card" data-tech="{{ project.tech|default:'[]'|escapejs }}">
        {% if project.image %}
          <img class="project-image" src="{{ project.image.url }}" alt="Image for {{ project.title }}">
        {% else %}
          <div style="width:110px;height:110px;border-radius:10px;background:linear-gradient(180deg,#0e0e0e,#151515);display:flex;align-items:center;justify-content:center;color:#8f8f8f;font-weight:600;border:1px solid rgba(255,255,255,0.02);">
            <i class="fas fa-folder-open" aria-hidden="true"></i>
          </div>
        {% endif %}
        <div class="project-body">
          <div class="project-title">{{ project.title }}</div>
          <div class="project-about">{{ project.about|truncatechars:240 }}</div>

          <div class="project-meta">
            {% if project.url %}
              <a href="{{ project.url }}" class="meta-link" target="_blank" rel="noopener noreferrer"><i class="fas fa-external-link-alt"></i> Visit</a>
            {% endif %}
            {% if project.year %}
              <span>{{ project.year }}</span>
            {% endif %}
          </div>

          <div class="tech-list" aria-label="Technologies used">
            {# Server-side rendering if project.tech is iterable (most common case) #}
            {% if project.tech %}
              {% if project.tech|length and project.tech.0 %}
                {% for tech in project.tech %}
                  <span class="tech-chip"><i class="fas fa-tag" aria-hidden="true"></i>{{ tech }}</span>
                {% endfor %}
              {% endif %}
            {% endif %}
            {# JS will fill in missing chips if necessary #}
          </div>
        </div>
      </div>
    {% endfor %}
    {% if user.profile == website.user %}
      <a style="text-decoration: none; color: whitesmoke;" href="/{{website.unique_name}}/projects" class="project-card"><strong>+ Add Project</strong><br><br>Create a new project</a>
    {% endif %}
  </section>

  <section class="cta" aria-labelledby="contact-title" style="padding-bottom: 10px;">
    <div class="section-title" id="contact-title" style="margin-top:40px;margin-bottom:18px;font-size:2rem;">Contact Me</div>

    <!-- Contact card -->
    <div class="contact-card" role="region" aria-label="Contact form">
      <div class="contact-left">
        <h3>Let's build something great</h3>
        <p class="lead">Tell me about your project or just say hi — I typically respond within a few days.</p>
        <p class="small-note">Prefer email? Send to <strong>{{website.email}}</strong></p>
      </div>

      <div class="contact-right">
        <form class="contact-form" id="contactForm" aria-label="Contact form">
          {%csrf_token%}
          <label class="field" aria-hidden="false">
            <!-- user icon -->
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M12 12a4 4 0 100-8 4 4 0 000 8zM3 20a9 9 0 0118 0H3z" fill="currentColor"/></svg>
            <input type="text" name="name" id="name" placeholder="Your name" required autocomplete="name" />
          </label>

          <label class="field">
            <!-- mail icon -->
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v.5L12 13 3 7.5V7zM21 9.2V17a2 2 0 01-2 2H5a2 2 0 01-2-2V9.2l8.5 4.5a2 2 0 001.5 0L21 9.2z" fill="currentColor"/></svg>
            <input type="email" name="email" id="email" placeholder="Your email" required autocomplete="email" />
          </label>

          <label class="field" style="align-items:flex-start;">
            <!-- message icon -->
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z" fill="currentColor"/></svg>
            <textarea name="message" id="message" rows="4" placeholder="Your message" required></textarea>
          </label>

          <button type="submit" class="btn-send" aria-label="Send message">Send Message</button>
          <div class="small-note" aria-hidden="true">By sending you agree to be awesome and respectful ✨</div>
        </form>
      </div>
    </div>
  </section>

  <!-- Floating nav -->
  <div id="float-nav" aria-hidden="false">
    <div class="float-icon" data-target="hero" title="Top" role="button" aria-label="Top"></div>
    <div class="float-icon" data-target="services" title="Services" role="button" aria-label="Services"></div>
    <div class="float-icon" data-target="skills" title="Skills" role="button" aria-label="Skills"></div>
    <div class="float-icon" data-target="timeline" title="Journey" role="button" aria-label="Journey"></div>
    <div class="float-icon" data-target="projects" title="Projects" role="button" aria-label="Projects"></div>
  </div>

  <!-- toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"><span id="toastIcon"></span><span id="toastText">Message sent — thanks! I'll get back to you shortly.</span></div>

  <script>
    /****************************
     * Helpers
     ****************************/
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // enhanced toast with types: 'success' | 'error' | 'info'
    function showToast(message, type = 'info', timeout = 3000) {
      const t = document.getElementById('toast');
      const text = document.getElementById('toastText');
      const icon = document.getElementById('toastIcon');
      if (!t || !text || !icon) return;

      // reset classes
      t.classList.remove('success', 'error');
      icon.innerHTML = '';

      if (type === 'success') {
        t.classList.add('success');
        icon.innerHTML = '<i class="fas fa-check" aria-hidden="true"></i>';
      } else if (type === 'error') {
        t.classList.add('error');
        icon.innerHTML = '<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>';
      } else {
        icon.innerHTML = '<i class="fas fa-info-circle" aria-hidden="true"></i>';
      }

      text.textContent = message;
      t.classList.add('show');

      clearTimeout(t._hideTimeout);
      t._hideTimeout = setTimeout(()=> {
        t.classList.remove('show', 'success', 'error');
        icon.innerHTML = '';
      }, timeout);
    }

    /****************************
     * float nav behavior
     ****************************/
    (function setupFloatNav(){
      const icons = Array.from(document.querySelectorAll('.float-icon'));
      const map = {};
      icons.forEach(i => map[i.dataset.target] = i);

      icons.forEach(icon => {
        icon.addEventListener('click', () => {
          const target = document.getElementById(icon.dataset.target) || document.querySelector('.' + icon.dataset.target);
          if (target) target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
        icon.tabIndex = 0;
        icon.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); icon.click(); }
        });
      });

      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          const icon = map[entry.target.id];
          if (!icon) return;
          if (entry.isIntersecting) {
            icons.forEach(ic => ic.classList.remove('active'));
            icon.classList.add('active');
          }
        });
      }, { root: null, rootMargin: '-40% 0px -40% 0px', threshold: 0.01 });

      Object.keys(map).forEach(k => {
        const sec = document.getElementById(k) || document.querySelector('.' + k);
        if (sec) io.observe(sec);
      });
    })();


    /****************************
     * Progress bars animation on scroll (kept)
     ****************************/
    (function setupSkillObservers(){
      const skills = document.querySelectorAll('.skill');
      if (!skills || skills.length === 0) return;

      function animateCount(elPercentNode, from, to, duration = 900) {
        const start = performance.now();
        function step(now) {
          const t = Math.min(1, (now - start) / duration);
          const eased = 1 - Math.pow(1 - t, 3);
          const current = Math.round(from + (to - from) * eased);
          elPercentNode.textContent = current + '%';
          if (t < 1) requestAnimationFrame(step);
          else elPercentNode.textContent = to + '%';
        }
        requestAnimationFrame(step);
      }

      const skillObserver = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting) return;
          const skillEl = entry.target;
          const bar = skillEl.querySelector('.progress .bar');
          if (!bar || bar.classList.contains('animated')) { obs.unobserve(skillEl); return; }

          const target = parseInt(bar.dataset.target || 0, 10);
          requestAnimationFrame(() => {
            bar.style.width = target + '%';
            bar.style.setProperty('--target-offset', target + '%');
            bar.classList.add('bar-filled');
            bar.classList.add('animated');
          });

          const progress = bar.closest('.progress');
          if (progress) progress.setAttribute('aria-valuenow', String(target));
          const percentNode = skillEl.querySelector('.percent');
          animateCount(percentNode, 0, target, 700 + Math.round(target * 5));
          obs.unobserve(skillEl);
        });
      }, { threshold: 0.45 });

      skills.forEach(s => skillObserver.observe(s));
    })();


    /****************************
     * Contact form behavior (kept)
     ****************************/
    (function(){
      const form=document.getElementById('contactForm'); if(!form) return;
      const submitBtn=form.querySelector('.btn-send');

      async function enterLoading(){if(submitBtn){submitBtn.disabled=true; submitBtn._prevHtml=submitBtn.innerHTML; submitBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Sending...'; submitBtn.style.cursor='wait';}document.documentElement.style.cursor='wait';document.body.style.cursor='wait';}
      function exitLoading(){if(submitBtn){submitBtn.disabled=false; if(submitBtn._prevHtml)submitBtn.innerHTML=submitBtn._prevHtml; submitBtn.style.cursor='';}document.documentElement.style.cursor='';document.body.style.cursor='';}

      form.addEventListener('submit',async e=>{
        e.preventDefault();
        const name=(form.querySelector('#name')?.value||'').trim();
        const email=(form.querySelector('#email')?.value||'').trim();
        const message=(form.querySelector('#message')?.value||'').trim();
        if(!name||!email||!message){showToast('Please complete all fields.','error'); return;}
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){showToast('Please enter a valid email.','error'); return;}
        const url="{% url 'website_contact' website.unique_name %}"; const csrftoken=getCookie('csrftoken');
        try{
          await enterLoading();
          const res=await fetch(url,{method:'POST',credentials:'same-origin',headers:{'Content-Type':'application/json', ...(csrftoken?{'X-CSRFToken':csrftoken}:{})},body:JSON.stringify({name,email,message})});
          if(res.ok){let data={}; try{data=await res.json();}catch(e){} showToast(data.message||'Message sent — the owner will receive an email.','success'); form.reset();}
          else {let info={message:'Failed to send message.'}; try{info=await res.json();}catch(e){} showToast(info.message||'Failed to send — try again later.','error');}
        }catch(err){console.error(err); showToast('Network error — could not send.','error');}finally{exitLoading();}
      });
    })();

    /****************************
     * Compute age client-side (if birth_date exists)
     ****************************/
    (function computeAge() {
      try {
        const aboutCard = document.querySelector('.about-card');
        if (!aboutCard) return;
        const dob = aboutCard.dataset.birthdate; // expected 'YYYY-MM-DD' or empty
        const ageNode = document.getElementById('computed-age');
        if (!dob || !ageNode) return;

        const parts = dob.split('-').map(Number);
        if (parts.length !== 3) return;
        const [y, m, d] = parts;
        const today = new Date();
        let age = today.getFullYear() - y;
        const hasHadBirthdayThisYear = (today.getMonth() + 1) > m || ((today.getMonth() + 1) === m && today.getDate() >= d);
        if (!hasHadBirthdayThisYear) age = age - 1;
        if (Number.isFinite(age) && age >= 0) {
          ageNode.textContent = age + ' years';
        } else {
          // fallback if website.age provided server-side already
          if (ageNode.textContent.trim() === '—' && typeof window.siteOwnerAge !== 'undefined') {
            ageNode.textContent = window.siteOwnerAge + ' years';
          }
        }
      } catch (e) { /* silent */ }
    })();

    /****************************
     * Render tech chips if dataset present or fallback parsing
     ****************************/
    (function renderTechChips() {
      try {
        const cards = document.querySelectorAll('.project-card');
        cards.forEach(card => {
          const listNode = card.querySelector('.tech-list');
          // if server-side already rendered chips, skip
          if (!listNode) return;
          const existingChips = listNode.querySelectorAll('.tech-chip');
          if (existingChips && existingChips.length > 0) return;

          const raw = card.dataset.tech || '[]';
          let techArr = [];
          // try parse JSON (expected common case)
          try {
            techArr = JSON.parse(raw);
            if (!Array.isArray(techArr)) techArr = [];
          } catch (err) {
            // fallback: try to parse a Python-list-like string "['React', 'Django']" or comma-separated
            const cleaned = raw.replace(/^\[|\]$/g, '').trim();
            if (cleaned.indexOf("'") >= 0 || cleaned.indexOf('"') >= 0) {
              // split on commas but strip quotes
              techArr = cleaned.split(',').map(s => s.replace(/['"]/g, '').trim()).filter(Boolean);
            } else if (cleaned.indexOf(',') >= 0) {
              techArr = cleaned.split(',').map(s => s.trim()).filter(Boolean);
            } else if (cleaned.length > 0) {
              techArr = [cleaned];
            } else {
              techArr = [];
            }
          }

          // create chips
          techArr.slice(0, 12).forEach(t => {
            const span = document.createElement('span');
            span.className = 'tech-chip';
            span.innerHTML = `<i class="fas fa-tag" aria-hidden="true"></i>${t}`;
            listNode.appendChild(span);
          });
        });
      } catch (e) { console.error(e); }
    })();

  </script>
  <script>
    // Auto-hide flash messages after 4 seconds
    setTimeout(() => {
      document.querySelectorAll('.flash-message').forEach(msg => {
        msg.style.transition = "opacity .4s, transform .4s";
        msg.style.opacity = "0";
        msg.style.transform = "translateY(-10px)";
        setTimeout(() => msg.remove(), 400);
      });
    }, 4000);
  </script>

</body>
</html>
